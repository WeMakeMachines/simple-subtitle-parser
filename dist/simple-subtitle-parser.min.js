"use strict";var t=function(r,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},t(r,n)};function r(r,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=r}t(r,n),r.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}var n=function(){return n=Object.assign||function(t){for(var r,n=1,e=arguments.length;n<e;n++)for(var o in r=arguments[n])Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o]);return t},n.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError;var e=function(t){var r=t.hours,n=void 0===r?0:r,e=t.minutes,o=void 0===e?0:e,s=t.seconds,i=void 0===s?0:s,a=t.ms;return 60*n*60+60*o+i+(void 0===a?0:a)/1e3},o=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return r(n,t),n}(Error),s=function(){function t(){}return t.parseTimeStamps=function(r,o){var s=r.split(o),i=s[0],a=s[1];if(a){var u=t.splitTimeStamp(i),c=t.splitTimeStamp(a);return{startTime:n(n({},u),{totals:{inSeconds:e(u)}}),endTime:n(n({},c),{totals:{inSeconds:e(c)}})}}},t.splitTimeStamp=function(t){var r=t.split(":"),n=r[0],e=r[1],s=r[2],i=s.includes(",")?",":s.includes(".")?".":"";if(""===i)throw new o("Unable to process timestamp");var a=s.split(i),u=a[0],c=a[1];return{hours:Number(n),minutes:Number(e),seconds:Number(u),ms:Number(c)}},t}(),i=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return r(n,t),n}(Error),a=function(){function t(){}return t.processStringToArray=function(t){return t.split("\n")},t.processArrayToArrayBlocks=function(t){return t.reduce((function(t,r){return""===r?t.push([]):t[t.length-1].push(r),t}),[[]])},t.dropEmptyArrayBlocks=function(t){return t.filter((function(t){return t.length}))},t.processArrayBlocksToCues=function(t,r){return t.map((function(t,n){var e=t.reduce((function(t,n,e){if(0===e&&!n.includes(r))return t;if(!t.endTime.totals.inSeconds&&n.includes(r)){var o=s.parseTimeStamps(n,r);return o&&(t.startTime=o.startTime,t.endTime=o.endTime),t}return t.text.push(n),t}),{sequence:n,startTime:{hours:0,minutes:0,seconds:0,ms:0,totals:{inSeconds:0}},endTime:{hours:0,minutes:0,seconds:0,ms:0,totals:{inSeconds:0}},text:[]});if(e.endTime.totals.inSeconds<=e.startTime.totals.inSeconds)throw new i("Invalid cue with secuence number ".concat(e.sequence,": ")+"start timecode "+"".concat(e.startTime.hours.toString().padStart(2,"0"))+":".concat(e.startTime.minutes.toString().padStart(2,"0"))+":".concat(e.startTime.seconds.toString().padStart(2,"0"))+":".concat(e.startTime.ms.toString().padStart(3,"0")," ")+"greater or equal than ending one "+"".concat(e.endTime.hours.toString().padStart(2,"0"))+":".concat(e.endTime.minutes.toString().padStart(2,"0"))+":".concat(e.endTime.seconds.toString().padStart(2,"0"))+":".concat(e.endTime.ms.toString().padStart(3,"0")," "));return e}))},t}(),u=function(t){function n(){var r=null!==t&&t.apply(this,arguments)||this;return r.timeStampMarker="--\x3e",r}return r(n,t),n.prototype.parse=function(t){var r=a.processStringToArray(t),n=a.processArrayToArrayBlocks(r),e=a.dropEmptyArrayBlocks(n);return a.processArrayBlocksToCues(e,this.timeStampMarker)},n}(a),c=function(t){function n(){var r=null!==t&&t.apply(this,arguments)||this;return r.timeStampMarker="--\x3e",r}return r(n,t),n.prototype.parse=function(t){var r=a.processStringToArray(t),n=a.processArrayToArrayBlocks(r),e=a.dropEmptyArrayBlocks(n),o=this.dropNonCueData(e);return a.processArrayBlocksToCues(o,this.timeStampMarker)},n.prototype.dropNonCueData=function(t){return t.filter((function(t){var r=t[0];return!(r.startsWith("WEBVTT")||r.startsWith("NOTE")||r.startsWith("STYLE"))}))},n}(a);exports.extractFormatFromFileName=function(t){var r,n=t.toLowerCase().split("."),e=n[n.length-1];switch(e){case"srt":r="SRT";break;case"vtt":r="WEBVTT";break;default:r="Unsupported"}return{extension:e,format:r}},exports.parser=function(t,r){return new Promise((function(n,e){var o="WEBVTT"===t?new c:new u;try{n(o.parse(r))}catch(t){e(t)}}))};
