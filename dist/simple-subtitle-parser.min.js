"use strict";var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(r[e]=t[e])},r(t,e)};function t(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}"function"==typeof SuppressedError&&SuppressedError;var e=function(r){var t=r.hours,e=void 0===t?0:t,n=r.minutes,o=void 0===n?0:n,i=r.seconds,s=void 0===i?0:i,u=r.milliseconds,a=1e3;return 60*e*60*a+60*o*a+s*a+(void 0===u?0:u)},n=function(r){function e(){return null!==r&&r.apply(this,arguments)||this}return t(e,r),e}(Error),o=function(){function r(){}return r.parseTimeStamps=function(t,n){var o=t.split(n),i=o[0],s=o[1];if(s){var u=r.splitTimeStamp(i),a=r.splitTimeStamp(s);return{startTime:e(u),endTime:e(a)}}},r.splitTimeStamp=function(r){var t=r.split(":"),e=t[0],o=t[1],i=t[2],s=i.includes(",")?",":i.includes(".")?".":"";if(""===s)throw new n("Unable to process timestamp");var u=i.split(s),a=u[0],c=u[1];return{hours:Number(e),minutes:Number(o),seconds:Number(a),milliseconds:Number(c)}},r}(),i=function(r){function e(){return null!==r&&r.apply(this,arguments)||this}return t(e,r),e}(Error),s=function(){function r(){}return r.processStringToArray=function(r){return r.split("\n")},r.processArrayToArrayBlocks=function(r){return r.reduce((function(r,t){return""===t?r.push([]):r[r.length-1].push(t),r}),[[]])},r.dropEmptyArrayBlocks=function(r){return r.filter((function(r){return r.length}))},r.processArrayBlocksToCues=function(r,t){return r.map((function(r,e){var n=r.reduce((function(r,e,n){if(0===n&&!e.includes(t))return r;if(!r.endTime&&e.includes(t)){var i=o.parseTimeStamps(e,t);return i&&(r.startTime=i.startTime,r.endTime=i.endTime),r}return r.text.push(e),r}),{sequence:e,startTime:0,endTime:0,text:[]});if(n.endTime<=n.startTime)throw new i("Invalid Cue: Timecodes not valid");return n}))},r}(),u=function(r){function e(){var t=null!==r&&r.apply(this,arguments)||this;return t.timeStampMarker="--\x3e",t}return t(e,r),e.prototype.parse=function(r){var t=s.processStringToArray(r),e=s.processArrayToArrayBlocks(t),n=s.dropEmptyArrayBlocks(e);return s.processArrayBlocksToCues(n,this.timeStampMarker)},e}(s),a=function(r){function e(){var t=null!==r&&r.apply(this,arguments)||this;return t.timeStampMarker="--\x3e",t}return t(e,r),e.prototype.parse=function(r){var t=s.processStringToArray(r),e=s.processArrayToArrayBlocks(t),n=s.dropEmptyArrayBlocks(e),o=this.dropNonCueData(n);return s.processArrayBlocksToCues(o,this.timeStampMarker)},e.prototype.dropNonCueData=function(r){return r.filter((function(r){var t=r[0];return!(t.startsWith("WEBVTT")||t.startsWith("NOTE")||t.startsWith("STYLE"))}))},e}(s);exports.extractFormatFromFileName=function(r){var t,e=r.toLowerCase().split("."),n=e[e.length-1];switch(n){case"srt":t="SRT";break;case"vtt":t="WEBVTT";break;default:t="Unsupported"}return{extension:n,format:t}},exports.parser=function(r,t){return new Promise((function(e,n){var o="WEBVTT"===r?new a:new u;try{e(o.parse(t))}catch(r){n(r)}}))};
