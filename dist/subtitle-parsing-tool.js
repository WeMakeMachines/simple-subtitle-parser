"use strict";var Formats;Object.defineProperty(exports,"__esModule",{value:!0}),function(r){r.Srt="SRT",r.WebVtt="WEBVTT"}(Formats=Formats||{});var extendStatics=function(r,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var e in t)t.hasOwnProperty(e)&&(r[e]=t[e])})(r,t)};function __extends(r,t){function e(){this.constructor=r}extendStatics(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}var timeValuesToMilliseconds=function(r){var t=r.hours,e=void 0===t?0:t,n=r.minutes,s=void 0===n?0:n,o=r.seconds,i=void 0===o?0:o,a=r.milliseconds;return 60*e*60*1e3+60*s*1e3+1e3*i+(void 0===a?0:a)},TimeStampsError=function(r){function t(){return null!==r&&r.apply(this,arguments)||this}return __extends(t,r),t}(Error),TimeStamps=function(){function a(){}return a.parseTimeStamps=function(r,t){var e=r.split(t),n=e[0],s=e[1];if(s){var o=a.splitTimeStamp(n),i=a.splitTimeStamp(s);return{startTime:timeValuesToMilliseconds(o),endTime:timeValuesToMilliseconds(i)}}},a.splitTimeStamp=function(r){var t=r.split(":"),e=t[0],n=t[1],s=t[2],o=s.includes(",")?",":s.includes(".")?".":"";if(!o)throw new TimeStampsError("Unable to process timestamp");var i=s.split(o),a=i[0],u=i[1];return{hours:Number(e),minutes:Number(n),seconds:Number(a),milliseconds:Number(u)}},a}(),ParserError=function(r){function t(){return null!==r&&r.apply(this,arguments)||this}return __extends(t,r),t}(Error),Parser=function(){function r(){this.timeStampMarker="--\x3e"}return r.prototype.processStringToArray=function(r){return r.split("\n")},r.prototype.processArrayToArrayBlocks=function(r){return r.reduce(function(r,t){return""===t?r.push([]):r[r.length-1].push(t),r},[[]])},r.prototype.dropEmptyArrayBlocks=function(r){return r.filter(function(r){return r.length})},r.prototype.processArrayBlocksToCues=function(r){var s=this;return r.map(function(r,t){var e=r.reduce(function(r,t,e){if(0===e&&!t.includes(s.timeStampMarker))return r;if(r.endTime||!t.includes(s.timeStampMarker))return r.text.push(t),r;var n=TimeStamps.parseTimeStamps(t,s.timeStampMarker);return n&&(r.startTime=n.startTime,r.endTime=n.endTime),r},{sequence:t,startTime:0,endTime:0,text:[]});if(e.endTime<=e.startTime)throw new ParserError("Invalid Cue: Timecodes not valid");return e})},r}(),SrtParser=function(r){function t(){return null!==r&&r.apply(this,arguments)||this}return __extends(t,r),t.prototype.parse=function(r){var t=this.processStringToArray(r),e=this.processArrayToArrayBlocks(t),n=this.dropEmptyArrayBlocks(e);return this.processArrayBlocksToCues(n)},t}(Parser),WebVttParser=function(r){function t(){return null!==r&&r.apply(this,arguments)||this}return __extends(t,r),t.prototype.parse=function(r){var t=this.processStringToArray(r),e=this.processArrayToArrayBlocks(t),n=this.dropEmptyArrayBlocks(e),s=this.dropNonCueData(n);return this.processArrayBlocksToCues(s)},t.prototype.dropNonCueData=function(r){return r.filter(function(r){var t=r[0];return!(t.startsWith("WEBVTT")||t.startsWith("NOTE")||t.startsWith("STYLE"))})},t}(Parser),parser=function(n,s){return new Promise(function(r,t){var e=new(n===Formats.WebVtt?WebVttParser:SrtParser);try{r(e.parse(s))}catch(r){t(r)}})};exports.parser=parser;
